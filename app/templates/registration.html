{% extends "base.html" %}
{% block title %}Registration{% endblock %}
{% block content %}
<div class="form-container">
    <h2>Getting Started</h2>
    <p>Please provide some basic information to begin your screening.</p>
    <form id="regForm" onsubmit="submitReg(event)">
        <div class="form-group">
            <label for="firstName">First Name *</label>
            <input type="text" id="firstName" name="firstName" required>
        </div>
        <div class="form-group">
            <label for="lastName">Last Name *</label>
            <input type="text" id="lastName" name="lastName" required>
        </div>
        <div class="form-group">
            <label for="age">Age *</label>
            <input type="number" id="age" name="age" min="13" max="100" required>
            <small>This screening is designed for adolescents and adults (13+)</small>
        </div>
        <div class="form-group">
            <label for="gender">Gender (Optional)</label>
            <select id="gender" name="gender">
                <option value="">Prefer not to say</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="other">Other</option>
            </select>
        </div>
        <div class="form-actions">
            <a href="/" class="btn btn-secondary">Back</a>
            <button type="submit" class="btn btn-primary">Continue to Questionnaire</button>
        </div>
    </form>
</div>
<script>
async function submitReg(e) {
    e.preventDefault();
    const genderVal = document.getElementById('gender').value;
    const data = {
        first_name: document.getElementById('firstName').value,
        last_name: document.getElementById('lastName').value,
        age: parseInt(document.getElementById('age').value)
    };
    // Only include gender if selected
    if (genderVal) {
        data.gender = genderVal;
    }
    
    console.log('Sending data:', data); // Debug log
    
    try {
        const res = await fetch('/api/registration/start', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        
        console.log('Response status:', res.status); // Debug log
        
        if (res.ok) {
            const result = await res.json();
            console.log('Response data:', result); // Debug log
            window.location.href = `/questionnaire?session_id=${result.session_id}`;
        } else {
            const errorData = await res.json();
            console.error('Error response:', errorData);
            alert('Registration failed: ' + (errorData.detail || 'Please try again.'));
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    }
}
</script>
{% endblock %}
